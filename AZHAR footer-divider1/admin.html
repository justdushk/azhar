<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å CMS</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f9fafb;
            color: #1f2937;
        }

        .login-screen {
            min-height: 100vh;
            background: linear-gradient(135deg, #dbeafe 0%, #cffafe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .login-box {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            padding: 2.5rem;
            width: 100%;
            max-width: 420px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #2563eb, #06b6d4);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: white;
            font-size: 24px;
        }

        .login-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #6b7280;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #374151;
            font-size: 0.9rem;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.95rem;
            transition: all 0.2s;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            width: 100%;
            padding: 0.875rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb, #06b6d4);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
        }

        .demo-info {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .admin-panel {
            display: none;
            min-height: 100vh;
        }

        .admin-panel.active {
            display: block;
        }

        .top-bar {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .top-bar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-admin {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #2563eb, #06b6d4);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .top-bar-title h1 {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .top-bar-subtitle {
            font-size: 0.8rem;
            color: #6b7280;
        }

        .top-bar-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .btn-save {
            background: #2563eb;
            color: white;
        }

        .btn-save:hover {
            background: #1d4ed8;
        }

        .btn-icon {
            padding: 0.5rem;
            background: transparent;
            border: none;
            cursor: pointer;
            color: #6b7280;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .main-container {
            display: flex;
        }

        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid #e5e7eb;
            min-height: calc(100vh - 73px);
            padding: 1rem;
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .menu-item {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            font-size: 0.95rem;
            color: #374151;
        }

        .menu-item:hover {
            background: #f3f4f6;
        }

        .menu-item.active {
            background: #dbeafe;
            color: #2563eb;
            font-weight: 600;
        }

        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            max-width: 1400px;
        }

        .content-header {
            margin-bottom: 2rem;
        }

        .content-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .content-subtitle {
            color: #6b7280;
            font-size: 1rem;
        }

        .card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .menu-item-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .menu-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .submenu-items {
            margin-left: 2rem;
            margin-top: 0.75rem;
            padding-left: 1rem;
            border-left: 2px solid #e5e7eb;
        }

        .submenu-item-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #10b981;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: none;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.show {
            display: flex;
        }

        .notification.error {
            background: #ef4444;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: #f3f4f6;
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            font-size: 1.25rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .page-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .page-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .page-url {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-primary {
            background: #dbeafe;
            color: #2563eb;
        }

        .badge-success {
            background: #d1fae5;
            color: #059669;
        }

        .preview-nav {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
        }

        .preview-nav-items {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .preview-nav-item {
            position: relative;
            padding: 0.5rem 0;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s;
        }

        .preview-nav-item:hover {
            color: #2563eb;
        }

        .preview-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 200px;
            padding: 0.5rem;
            margin-top: 0.5rem;
            display: none;
            z-index: 10;
        }

        .preview-nav-item:hover .preview-dropdown {
            display: block;
        }

        .preview-dropdown-item {
            padding: 0.5rem 1rem;
            color: #374151;
            border-radius: 0.375rem;
            transition: background 0.2s;
        }

        .preview-dropdown-item:hover {
            background: #f3f4f6;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .content {
                padding: 1rem;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="login-header">
                <div class="login-icon">üîê</div>
                <h1 class="login-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å CMS</h1>
                <p class="login-subtitle">–í–æ–π–¥–∏—Ç–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∞–π—Ç–æ–º</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">–õ–æ–≥–∏–Ω</label>
                    <input type="text" class="form-input" id="username" placeholder="admin" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
                <p class="demo-info">–î–µ–º–æ: admin / admin123</p>
            </form>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel">
        <div class="notification" id="notification">‚úì –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!</div>

        <div class="top-bar">
            <div class="top-bar-left">
                <div class="logo-admin">üìã</div>
                <div class="top-bar-title">
                    <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å CMS</h1>
                    <div class="top-bar-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–æ–º + Supabase</div>
                </div>
            </div>
            <div class="top-bar-right">
                <button class="btn-sm btn-save" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn-sm btn-secondary" id="syncBtn">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                <button class="btn-icon" id="logoutBtn">üö™</button>
            </div>
        </div>

        <div class="main-container">
            <aside class="sidebar">
                <nav class="sidebar-menu">
                    <button class="menu-item active" data-view="dashboard">üè† Dashboard</button>
                    <button class="menu-item" data-view="navigation">üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è</button>
                    <button class="menu-item" data-view="pages">üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã</button>
                    <button class="menu-item" data-view="sections">üß© –°–µ–∫—Ü–∏–∏</button>
                    <button class="menu-item" data-view="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </nav>
            </aside>

            <main class="content" id="mainContent"></main>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –º–µ–Ω—é -->
    <div class="modal" id="menuModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="menuModalTitle">–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é</h3>
                <button class="modal-close" onclick="closeMenuModal()">‚úï</button>
            </div>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞</label>
                <input type="text" id="menuItemName" class="form-input" placeholder="–û —Ü–µ–Ω—Ç—Ä–µ">
            </div>
            <div class="form-group">
                <label class="form-label">URL (–µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–ø—É–Ω–∫—Ç–æ–≤)</label>
                <input type="text" id="menuItemUrl" class="form-input" placeholder="/about –∏–ª–∏ #about">
            </div>
            <div class="form-group">
                <label class="form-label">–ò–º–µ–µ—Ç –ø–æ–¥–ø—É–Ω–∫—Ç—ã</label>
                <select id="menuItemHasChildren" class="form-select">
                    <option value="false">–ù–µ—Ç</option>
                    <option value="true">–î–∞</option>
                </select>
            </div>
            <button onclick="saveMenuItem()" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="modal" id="pageModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</h3>
                <button class="modal-close" onclick="closePageModal()">‚úï</button>
            </div>
            <div class="form-group">
                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</label>
                <input type="text" id="pageName" class="form-input" placeholder="–û —Ü–µ–Ω—Ç—Ä–µ">
            </div>
            <div class="form-group">
                <label class="form-label">URL (slug)</label>
                <input type="text" id="pageSlug" class="form-input" placeholder="/about">
            </div>
            <div class="form-group">
                <label class="form-label">SEO Title</label>
                <input type="text" id="pageTitle" class="form-input" placeholder="–û —Ü–µ–Ω—Ç—Ä–µ - –†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä">
            </div>
            <div class="form-group">
                <label class="form-label">SEO Description</label>
                <textarea id="pageDescription" class="form-textarea" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º"></textarea>
            </div>
            <button onclick="savePage()" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
        </div>
    </div>

    <script>
        // ============ SUPABASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ============
       const SUPABASE_URL = 'https://pjxnokhkqchjillaoopi.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqeG5va2hrcWNoamlsbGFvb3BpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NjkwMjMsImV4cCI6MjA3OTU0NTAyM30.CuwUr1TPOjZBO8CB9n8QMImhJH9-Q8Qn0y0bafezj3o';

    let supabase = null;
    let useSupabase = false;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–ª—é—á –∏ url –Ω–µ –ø—É—Å—Ç—ã–µ –∏ –Ω–µ —Ä–∞–≤–Ω—ã –∑–∞–≥–ª—É—à–∫–∞–º
    if (SUPABASE_URL && SUPABASE_KEY && SUPABASE_URL !== 'https://your-project.supabase.co' && SUPABASE_KEY !== 'your-anon-key') {
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            useSupabase = true;
            console.log('‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –ø—Ä–æ–µ–∫—Ç—É: pjxnokhkqchjillaoopi');
        } catch (e) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Supabase:', e);
            console.warn('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LocalStorage –∫–∞–∫ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ');
        }
    } else {
        console.warn('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SUPABASE_URL –∏ SUPABASE_KEY!');
    }

        // ============ –î–ê–ù–ù–´–ï ============
        let siteData = {
            navigation: [
                { id: 'nav1', name: '–û —Ü–µ–Ω—Ç—Ä–µ', url: '#about', hasChildren: false, children: [], order: 0 },
                { id: 'nav2', name: '–£—Å–ª—É–≥–∏', url: '#services', hasChildren: false, children: [], order: 1 },
                { id: 'nav3', name: '–ö–æ–Ω—Ç–∞–∫—Ç—ã', url: '#contact', hasChildren: false, children: [], order: 2 }
            ],
            pages: [
                { id: 'home', name: '–ì–ª–∞–≤–Ω–∞—è', slug: '/', seo: { title: '–ì–ª–∞–≤–Ω–∞—è', description: '–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä' }, sections: [] }
            ],
            globalSettings: {
                logo: '–ö–ì–ü –Ω–∞ –ü–•–í "–û–±–ª–∞—Å—Ç–Ω–æ–π —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä"',
                contacts: { phone: '55-52-10', mobile: '8 (708) 466-57-15', address: '–≥. –ü–∞–≤–ª–æ–¥–∞—Ä, —É–ª. –õ–µ—Ä–º–æ–Ω—Ç–æ–≤–∞, 59' }
            }
        };

        let currentView = 'dashboard';
        let editingMenuItem = null;
        let editingMenuParent = null;

        // ============ –§–£–ù–ö–¶–ò–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø/–ó–ê–ì–†–£–ó–ö–ò ============
        async function saveData() {
            try {
                if (useSupabase && supabase) {
                    const { data, error } = await supabase
                        .from('site_data')
                        .upsert({ id: 1, data: siteData, updated_at: new Date().toISOString() });
                    
                    if (error) throw error;
                    showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Supabase!');
                } else {
                    localStorage.setItem('cmsData', JSON.stringify(siteData));
                    showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ!');
                }
                console.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', siteData);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
            }
        }

        async function loadData() {
            try {
                if (useSupabase && supabase) {
                    const { data, error } = await supabase
                        .from('site_data')
                        .select('*')
                        .eq('id', 1)
                        .single();
                    
                    if (error) throw error;
                    if (data && data.data) {
                        siteData = data.data;
                        console.log('üì• –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Supabase');
                    }
                } else {
                    const saved = localStorage.getItem('cmsData');
                    if (saved) {
                        siteData = JSON.parse(saved);
                        console.log('üì• –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ LocalStorage');
                    }
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
            }
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification show' + (type === 'error' ? ' error' : '');
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        // ============ –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ============
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            if (username === 'admin' && password === 'admin123') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').classList.add('active');
                await loadData();
                renderView('dashboard');
                showNotification('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
            } else {
                showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!', 'error');
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            if (confirm('–í—ã–π—Ç–∏?')) location.reload();
        });

        document.getElementById('saveBtn').addEventListener('click', saveData);
        document.getElementById('syncBtn').addEventListener('click', async () => {
            await loadData();
            renderView(currentView);
            showNotification('üîÑ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!');
        });

        // ============ –ù–ê–í–ò–ì–ê–¶–ò–Ø –ü–û –ú–ï–ù–Æ ============
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                currentView = item.dataset.view;
                renderView(currentView);
            });
        });

        // ============ –†–ï–ù–î–ï–† –ü–†–ï–î–°–¢–ê–í–õ–ï–ù–ò–ô ============
        function renderView(view) {
            const content = document.getElementById('mainContent');
            switch(view) {
                case 'dashboard': content.innerHTML = renderDashboard(); break;
                case 'navigation': content.innerHTML = renderNavigation(); break;
                case 'pages': content.innerHTML = renderPages(); break;
                case 'sections': content.innerHTML = renderSections(); break;
                case 'settings': content.innerHTML = renderSettings(); break;
            }
        }

        function renderDashboard() {
            return `
                <div class="content-header">
                    <h2 class="content-title">Dashboard</h2>
                    <p class="content-subtitle">–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã</p>
                </div>
                <div class="card">
                    <h3 class="card-title">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
                    <p style="color: ${useSupabase ? '#059669' : '#f59e0b'}; font-weight: 600;">
                        ${useSupabase ? '‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω' : '‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LocalStorage (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Supabase)'}
                    </p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div class="card">
                        <div style="font-size: 2rem; font-weight: 700; color: #2563eb;">${siteData.navigation.length}</div>
                        <div style="color: #6b7280;">–ü—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é</div>
                    </div>
                    <div class="card">
                        <div style="font-size: 2rem; font-weight: 700; color: #059669;">${siteData.pages.length}</div>
                        <div style="color: #6b7280;">–°—Ç—Ä–∞–Ω–∏—Ü</div>
                    </div>
                    <div class="card">
                        <div style="font-size: 2rem; font-weight: 700; color: #f59e0b;">${siteData.pages.reduce((sum, p) => sum + (p.sections?.length || 0), 0)}</div>
                        <div style="color: #6b7280;">–°–µ–∫—Ü–∏–π</div>
                    </div>
                </div>
            `;
        }

        function renderNavigation() {
            return `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <div>
                        <h2 class="content-title">–ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é</h2>
                        <p class="content-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–∞–º–∏ –º–µ–Ω—é –∏ –ø–æ–¥–ø—É–Ω–∫—Ç–∞–º–∏</p>
                    </div>
                    <button onclick="openMenuModal()" class="btn-sm btn-save" style="border: none;">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
                </div>

                <div class="card">
                    <h3 class="card-title">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–µ–Ω—é</h3>
                    <div class="preview-nav">
                        <div class="preview-nav-items">
                            ${siteData.navigation.sort((a,b) => a.order - b.order).map(item => `
                                <div class="preview-nav-item">
                                    ${item.name}
                                    ${item.hasChildren && item.children.length > 0 ? `
                                        <div class="preview-dropdown">
                                            ${item.children.map(child => `
                                                <div class="preview-dropdown-item">${child.name}</div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é</h3>
                    ${siteData.navigation.sort((a,b) => a.order - b.order).map(item => `
                        <div class="menu-item-card">
                            <div class="menu-item-header">
                                <div>
                                    <strong style="font-size: 1.05rem;">${item.name}</strong>
                                    ${!item.hasChildren ? `<div style="color: #6b7280; font-size: 0.875rem;">URL: ${item.url}</div>` : '<div style="color: #f59e0b; font-size: 0.875rem;">‚ö†Ô∏è –ò–º–µ–µ—Ç –ø–æ–¥–ø—É–Ω–∫—Ç—ã (URL –æ—Ç–∫–ª—é—á–µ–Ω)</div>'}
                                </div>
                                <div class="menu-item-actions">
                                    <button onclick="moveMenuItem('${item.id}', 'up')" class="btn-icon" title="–í–≤–µ—Ä—Ö">‚¨ÜÔ∏è</button>
                                    <button onclick="moveMenuItem('${item.id}', 'down')" class="btn-icon" title="–í–Ω–∏–∑">‚¨áÔ∏è</button>
                                    <button onclick="editMenuItem('${item.id}')" class="btn-icon" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                                    ${item.hasChildren ? `<button onclick="addSubmenuItem('${item.id}')" class="btn-icon" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø—É–Ω–∫—Ç">‚ûï</button>` : ''}
                                    <button onclick="deleteMenuItem('${item.id}')" class="btn-icon" style="color: #ef4444;" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                                </div>
                            </div>
                            ${item.hasChildren && item.children.length > 0 ? `
                                <div class="submenu-items">
                                    ${item.children.map((child, idx) => `
                                        <div class="submenu-item-card">
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <div>
                                                    <strong>${child.name}</strong>
                                                    <div style="color: #6b7280; font-size: 0.875rem;">URL: ${child.url}</div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;">
                                                    <button onclick="editSubmenuItem('${item.id}', ${idx})" class="btn-icon">‚úèÔ∏è</button>
                                                    <button onclick="deleteSubmenuItem('${item.id}', ${idx})" class="btn-icon" style="color: #ef4444;">üóëÔ∏è</button>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderPages() {
            return `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <div>
                        <h2 class="content-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏</h2>
                        <p class="content-subtitle">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–π—Ç–∞</p>
                    </div>
                    <button onclick="openPageModal()" class="btn-sm btn-save" style="border: none;">‚ûï –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
                </div>

                <div style="display: grid; gap: 1rem;">
                    ${siteData.pages.map(page => `
                        <div class="page-card">
                            <div class="page-header">
                                <div>
                                    <div class="page-title">${page.name}</div>
                                    <div class="page-url">${page.slug}</div>
                                    ${page.slug === '/' ? '<span class="badge badge-primary">–ì–ª–∞–≤–Ω–∞—è</span>' : ''}
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="editPage('${page.id}')" class="btn-icon">‚úèÔ∏è</button>
                                    ${page.slug !== '/' ? `<button onclick="deletePage('${page.id}')" class="btn-icon" style="color: #ef4444;">üóëÔ∏è</button>` : ''}
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                                <div>
                                    <div style="color: #6b7280; font-size: 0.875rem;">–°–µ–∫—Ü–∏–π</div>
                                    <div style="font-weight: 600;">${page.sections?.length || 0}</div>
                                </div>
                                <div>
                                    <div style="color: #6b7280; font-size: 0.875rem;">SEO Title</div>
                                    <div style="font-weight: 600; font-size: 0.875rem;">${page.seo.title}</div>
                                </div>
                                <div>
                                    <div style="color: #6b7280; font-size: 0.875rem;">–°—Ç–∞—Ç—É—Å</div>
                                    <span class="badge badge-success">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderSections() {
            return `
                <div class="content-header">
                    <h2 class="content-title">–†–µ–¥–∞–∫—Ç–æ—Ä —Å–µ–∫—Ü–∏–π</h2>
                    <p class="content-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞–º–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</p>
                </div>
                <div class="card">
                    <p style="text-align: center; color: #6b7280; padding: 2rem;">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ–∫—Ü–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏</p>
                </div>
            `;
        }

        function renderSettings() {
            return `
                <div class="content-header">
                    <h2 class="content-title">–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <p class="content-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–∞–π—Ç–∞</p>
                </div>
                <div class="card">
                    <h3 class="card-title">–õ–æ–≥–æ—Ç–∏–ø –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ</h3>
                    <input type="text" value="${siteData.globalSettings.logo}" onchange="updateSetting('logo', this.value)" class="form-input">
                </div>
                <div class="card">
                    <h3 class="card-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <div class="form-row">
                        <div>
                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="text" value="${siteData.globalSettings.contacts.phone}" onchange="updateContact('phone', this.value)" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">–ú–æ–±–∏–ª—å–Ω—ã–π</label>
                            <input type="text" value="${siteData.globalSettings.contacts.mobile}" onchange="updateContact('mobile', this.value)" class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ê–¥—Ä–µ—Å</label>
                        <input type="text" value="${siteData.globalSettings.contacts.address}" onchange="updateContact('address', this.value)" class="form-input">
                    </div>
                </div>
            `;
        }

        // ============ –§–£–ù–ö–¶–ò–ò –ú–ï–ù–Æ ============
        function openMenuModal(parentId = null, itemId = null) {
            editingMenuItem = itemId;
            editingMenuParent = parentId;
            
            const modal = document.getElementById('menuModal');
            const title = document.getElementById('menuModalTitle');
            const nameInput = document.getElementById('menuItemName');
            const urlInput = document.getElementById('menuItemUrl');
            const hasChildrenSelect = document.getElementById('menuItemHasChildren');

            if (itemId) {
                let item;
                if (parentId) {
                    const parent = siteData.navigation.find(n => n.id === parentId);
                    item = parent.children.find(c => c.id === itemId);
                    title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø—É–Ω–∫—Ç';
                } else {
                    item = siteData.navigation.find(n => n.id === itemId);
                    title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é';
                }
                nameInput.value = item.name;
                urlInput.value = item.url || '';
                hasChildrenSelect.value = item.hasChildren ? 'true' : 'false';
            } else {
                title.textContent = parentId ? '–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø—É–Ω–∫—Ç' : '–î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é';
                nameInput.value = '';
                urlInput.value = '';
                hasChildrenSelect.value = 'false';
            }

            modal.classList.add('show');
        }

        function closeMenuModal() {
            document.getElementById('menuModal').classList.remove('show');
            editingMenuItem = null;
            editingMenuParent = null;
        }

        function saveMenuItem() {
            const name = document.getElementById('menuItemName').value.trim();
            const url = document.getElementById('menuItemUrl').value.trim();
            const hasChildren = document.getElementById('menuItemHasChildren').value === 'true';

            if (!name) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–∞!', 'error');
                return;
            }

            if (!hasChildren && !url) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ URL –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–ò–º–µ–µ—Ç –ø–æ–¥–ø—É–Ω–∫—Ç—ã"!', 'error');
                return;
            }

            if (editingMenuItem) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                if (editingMenuParent) {
                    const parent = siteData.navigation.find(n => n.id === editingMenuParent);
                    const child = parent.children.find(c => c.id === editingMenuItem);
                    child.name = name;
                    child.url = url;
                } else {
                    const item = siteData.navigation.find(n => n.id === editingMenuItem);
                    item.name = name;
                    item.url = hasChildren ? '' : url;
                    item.hasChildren = hasChildren;
                    if (!hasChildren) item.children = [];
                }
            } else {
                // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ
                if (editingMenuParent) {
                    const parent = siteData.navigation.find(n => n.id === editingMenuParent);
                    parent.children.push({
                        id: 'submenu_' + Date.now(),
                        name,
                        url
                    });
                } else {
                    siteData.navigation.push({
                        id: 'nav_' + Date.now(),
                        name,
                        url: hasChildren ? '' : url,
                        hasChildren,
                        children: [],
                        order: siteData.navigation.length
                    });
                }
            }

            saveData();
            closeMenuModal();
            renderView('navigation');
        }

        function editMenuItem(id) {
            openMenuModal(null, id);
        }

        function addSubmenuItem(parentId) {
            openMenuModal(parentId, null);
        }

        function editSubmenuItem(parentId, childIndex) {
            const parent = siteData.navigation.find(n => n.id === parentId);
            const child = parent.children[childIndex];
            openMenuModal(parentId, child.id);
        }

        function deleteMenuItem(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç –º–µ–Ω—é?')) {
                siteData.navigation = siteData.navigation.filter(n => n.id !== id);
                saveData();
                renderView('navigation');
            }
        }

        function deleteSubmenuItem(parentId, childIndex) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ–¥–ø—É–Ω–∫—Ç?')) {
                const parent = siteData.navigation.find(n => n.id === parentId);
                parent.children.splice(childIndex, 1);
                saveData();
                renderView('navigation');
            }
        }

        function moveMenuItem(id, direction) {
            const index = siteData.navigation.findIndex(n => n.id === id);
            if (direction === 'up' && index > 0) {
                [siteData.navigation[index], siteData.navigation[index - 1]] = 
                [siteData.navigation[index - 1], siteData.navigation[index]];
            } else if (direction === 'down' && index < siteData.navigation.length - 1) {
                [siteData.navigation[index], siteData.navigation[index + 1]] = 
                [siteData.navigation[index + 1], siteData.navigation[index]];
            }
            siteData.navigation.forEach((item, i) => item.order = i);
            saveData();
            renderView('navigation');
        }

        // ============ –§–£–ù–ö–¶–ò–ò –°–¢–†–ê–ù–ò–¶ ============
        function openPageModal() {
            document.getElementById('pageModal').classList.add('show');
        }

        function closePageModal() {
            document.getElementById('pageModal').classList.remove('show');
        }

        function savePage() {
            const name = document.getElementById('pageName').value.trim();
            const slug = document.getElementById('pageSlug').value.trim();
            const title = document.getElementById('pageTitle').value.trim();
            const description = document.getElementById('pageDescription').value.trim();

            if (!name || !slug) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!', 'error');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ slug
            if (siteData.pages.find(p => p.slug === slug)) {
                showNotification('‚ùå –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–∫–∏–º URL —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!', 'error');
                return;
            }

            const newPage = {
                id: 'page_' + Date.now(),
                name,
                slug,
                seo: {
                    title: title || name,
                    description: description || ''
                },
                sections: []
            };

            siteData.pages.push(newPage);
            saveData();
            closePageModal();
            renderView('pages');
            showNotification('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞!');

            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('pageName').value = '';
            document.getElementById('pageSlug').value = '';
            document.getElementById('pageTitle').value = '';
            document.getElementById('pageDescription').value = '';
        }

        function editPage(id) {
            const page = siteData.pages.find(p => p.id === id);
            if (!page) return;

            document.getElementById('pageName').value = page.name;
            document.getElementById('pageSlug').value = page.slug;
            document.getElementById('pageTitle').value = page.seo.title;
            document.getElementById('pageDescription').value = page.seo.description;
            
            openPageModal();
        }

        function deletePage(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É?')) {
                siteData.pages = siteData.pages.filter(p => p.id !== id);
                saveData();
                renderView('pages');
                showNotification('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–¥–∞–ª–µ–Ω–∞!');
            }
        }

        // ============ –§–£–ù–ö–¶–ò–ò –ù–ê–°–¢–†–û–ï–ö ============
        function updateSetting(key, value) {
            siteData.globalSettings[key] = value;
            saveData();
        }

        function updateContact(key, value) {
            siteData.globalSettings.contacts[key] = value;
            saveData();
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        document.getElementById('menuModal').addEventListener('click', (e) => {
            if (e.target.id === 'menuModal') closeMenuModal();
        });

        document.getElementById('pageModal').addEventListener('click', (e) => {
            if (e.target.id === 'pageModal') closePageModal();
        });
    </script>
</body>
</html>